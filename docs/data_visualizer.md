# data_visualizer

```
Usage: ./data_visualizer [OPTIONS]

Options:
  -h,--help                   Print this help message and exit
  --config                    Read an ini file
[Option Group: Version]
  Options:
    --version                   Show version information
[Option Group: Regular]
  Positionals:
    mixd_file_name TEXT REQUIRED
                                The name of the MIXD file to read
    data_file_name TEXT REQUIRED
                                The name of the data file to read
    vtk-output-dir TEXT:DIR REQUIRED
                                Directory to write vtk files to
  Options:
    --problem-type TEXT:{advection_diffusion,cns,emum,ins,rvtcns,solid,soliduv,viscoelastic}
                                The problem type to use for the data file
    --data-entry [TEXT,UINT] ...
                                The data entries to construct the problem type from
    --vtk-mesh-name-format TEXT [mesh_{}.vtu] 
                                Format string for vtk mesh files
    --vtk-output-name-format TEXT [simulation_{}.vtu] 
                                Format string for vtk mesh files
    --write-config TEXT         Write the config to a file
  Regular:
    with_coordinates            Add to vtk files with percomputed coordinates
    without_coordinates         Add to vtk files without percomputed coordinates
```

The data visualizer tool is used to add information from a simulation to the VTK files generated by the `stmesher` tool. It reads an MIXD file and a data file, which contains the simulation results, and writes the results to existing VTK files.

## General arguments

The `data_visualizer` tool must always be passed the name of an MIXD `.minf` file, a data file and the directory in which the VTK files are located and new VTK files will be written to. 

The name format of the input and output vtk files may be specified via the `--vtk-mesh-name-format` and `--vtk-output-name-format` options, respectively. The default for the input mesh files is `mesh_{}.vtu`, while the default for the output files is `simulation_{}.vtu`. The `{}` will be replaced by the time step number.

By default, each entry in the data file will be added as a separate point data array named `u_1`,`u_2`,... Instead, the data can be split into more sensible arrays by specifying a known problem type via the `--problem-type` parameter. The available problem types are `advection_diffusion`, `cns`, `emum`, `ins`, `rvtcns`, `solid`, `soliduv` and `viscoelastic`. 

Alternatively, for custom problem types the data entries may be specified directly using the `--data-entry` parameter, which must be specified once for each data entry in order and takes  pairs of the form `name,length`, where `name` is the name of the data entry and `length` is the length of the vector(i.e. 1 for scalars).

## Modes

### with_coordinates

```
Add to vtk files with percomputed coordinates
Usage: ./data_visualizer with_coordinates [OPTIONS] vtk-out-coord-format steps

Positionals:
  vtk-out-coord-format TEXT REQUIRED
                              Format string for the coordinates file name
  steps UINT REQUIRED         Number of steps of mesh

Options:
  -h,--help                   Print this help message and exit
```

If the VTK files were output alongside the coordinates of the slice vertices, the `with_coordinates` mode can be used to add the simulation results to them. In this case, the coordinates of the slice vertices are read from a file specified by the `vtk-out-coord-format` argument, which is a format string that will be filled with the time step number. The number of steps must also be specified as a positional argument.

### without_coordinates

```
Add to vtk files without percomputed coordinates
Usage: ./data_visualizer without_coordinates [OPTIONS] [SUBCOMMAND]

Options:
  -h,--help                   Print this help message and exit
  --vtk-output-dt FLOAT [0.5] 
                              Time step for vtk output
  --min-time FLOAT            The minimum time of the triangulation for offsetting the vtk coordinates when mapping to space-time
  --output-scale FLOAT        The scale for the vtk coordinates when mapping to space-time

Regular:
  transform                   Apply 4D affine transformation
```

If these coordinates were not output, the `without_coordinates` mode can be used to add the simulation results to the VTK files. In this case, the coordinates of the slice vertices will be computed from the VTK files and the time step number. However, this rqeuires additional information which may be provided by the `--vtk-output-dt`, `--min-time` and `--output-scale` options, which must match those used in `stmesher`. The correct argument to  `--min-time` may be found in the output of `stmesher`, but is typically 0.

#### Transformation subcommand

```
Apply 4D affine transformation
Usage: ./mesh_analyzer transform [OPTIONS]

Options:
  -h,--help                   Print this help message and exit
  -t,--translate [FLOAT,FLOAT,FLOAT,FLOAT] x 4 Excludes: --matrix
                              4D translation vector (x,y,z,w)
  --rotate-xy FLOAT Excludes: --matrix
                              Rotation angle in radians for XY plane
  --rotate-xz FLOAT Excludes: --matrix
                              Rotation angle in radians for XZ plane
  --rotate-xw FLOAT Excludes: --matrix
                              Rotation angle in radians for XW plane
  --rotate-yz FLOAT Excludes: --matrix
                              Rotation angle in radians for YZ plane
  --rotate-yw FLOAT Excludes: --matrix
                              Rotation angle in radians for YW plane
  --rotate-zw FLOAT Excludes: --matrix
                              Rotation angle in radians for ZW plane
  -s,--scale [FLOAT,FLOAT,FLOAT,FLOAT] x 4 Excludes: --matrix
                              Scale factors (x,y,z,w)
  --matrix FLOAT x 20 Excludes: --translate --rotate-xy --rotate-xz --rotate-xw --rotate-yz --rotate-yw --rotate-zw --scale
                              Custom transform matrix (20 elements, row-major)
```

The `transform` subcommand must be used if a 4D affine transformation was applied during slicing with `stmesher`.

The transformation may either be specified as a combination of a non-uniform scaling, translation and rotation via the `--translate`, `--rotate-xy`, `--rotate-xz`, `--rotate-xw`, `--rotate-yz`, `--rotate-yw`, `--rotate-zw` and `--scale` parameters, or as a custom transformation matrix via the `--matrix` parameter. The latter is specified in row-major order, with 20 elements for a 4D affine transformation. The overall matrix must match the one used in `stmesher`.


## Debug Information 

To get debug information, is is possible to set the `SPDLOG_LEVEL` environment variable to `debug`:
```bash
SPDLOG_LEVEL=debug ./data_visualizer [...]
```

## Configurations

Instead of command line arguments, a configuration file in TOML format may be provided via the `--config` option. In order to generate a configuration file from the given command line arguments, the `--write-config` option may be used. This will write the configuration to the specified file in TOML format to get you started.
